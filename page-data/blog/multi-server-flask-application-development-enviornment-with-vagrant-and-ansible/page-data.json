{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-js","path":"/blog/multi-server-flask-application-development-enviornment-with-vagrant-and-ansible/","result":{"data":{"markdownRemark":{"html":"<p>I recently discovered <a href=\"http://vagrantup.com/\">Vagrant</a> which is a great tool that makes managing and provisioning local virtual machines rather superficial. Additionally, I recently found that there is a project called <a href=\"https://github.com/dsander/vagrant-ansible\">vagrant-ansible</a> that adds support for provisioning VMs with <a href=\"http://ansible.github.com/\">Ansible</a>. Ansible is my favorite new system configuration tool, which might be evident in a <a href=\"http://mattupstate.github.com/python/devops/2012/08/07/flask-wsgi-application-deployment-with-ubuntu-ansible-nginx-supervisor-and-uwsgi.html\">previous article</a>. This article is sort of a continuation of that previous article. The main difference being that I've added a database server to the mix to illustrate how one my mimic their staging or production environments on a development machine.</p>\n<h2>Requirements</h2>\n<p>If you plan on following along with this tutorial you will need to install the following software. Please follow the installation instructions provided:</p>\n<ul>\n<li><a href=\"http://downloads.vagrantup.com/tags/v1.0.3\">Vagrant</a></li>\n<li><a href=\"https://github.com/dsander/vagrant-ansible/blob/master/README.md\">vagrant-ansible</a></li>\n<li><a href=\"http://ansible.github.com/gettingstarted.html\">Ansible</a></li>\n</ul>\n<p>Additionally, the source code is available at <a href=\"https://github.com/mattupstate/vagrant-ansible-tutorial\">https://github.com/mattupstate/vagrant-ansible-tutorial</a>. Clone the repository on your machine.</p>\n<h2>The Setup</h2>\n<p>Generally speaking a web application has at least two servers:</p>\n<ul>\n<li>Web server</li>\n<li>Database server</li>\n</ul>\n<p>The web server runs the application code. In this case it runs a <a href=\"http://flask.pocoo.org/\">Flask</a> application using Nginx, uWSGI, and Supervisor. However, the web server could hypothetically consist of any sort of stack such as Apache and PHP. The database server hosts the database. In this case it is a PostgreSQL server but it could anything such as MySQL, MongoDB, etc.</p>\n<h3>Vagrantfile</h3>\n<p>The servers are defined in the file named <code class=\"language-text\">Vagrantfile</code> located at the root of the source code. The contents look like such:</p>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token keyword\">require</span> <span class=\"token string-literal\"><span class=\"token string\">'vagrant-ansible'</span></span>\n\nVagrant<span class=\"token double-colon punctuation\">::</span>Config<span class=\"token punctuation\">.</span>run <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>config<span class=\"token operator\">|</span>\n\n  config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>define <span class=\"token symbol\">:web</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>web_config<span class=\"token operator\">|</span>\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>box <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"oneiric32_base\"</span></span>\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>box_url <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://files.travis-ci.org/boxes/bases/oneiric32_base.box\"</span></span>\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>forward_port <span class=\"token number\">80</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8080</span>\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>network <span class=\"token symbol\">:bridged</span>\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>network <span class=\"token symbol\">:hostonly</span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">\"192.168.100.10\"</span></span>\n\n    web_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>provision <span class=\"token symbol\">:ansible</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>ansible<span class=\"token operator\">|</span>\n      ansible<span class=\"token punctuation\">.</span>playbook <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"devops/webserver.yml\"</span></span>\n      ansible<span class=\"token punctuation\">.</span>hosts <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"webservers\"</span></span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n  config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>define <span class=\"token symbol\">:db</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>db_config<span class=\"token operator\">|</span>\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>box <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"oneiric32_base\"</span></span>\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>box_url <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"http://files.travis-ci.org/boxes/bases/oneiric32_base.box\"</span></span>\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>forward_port <span class=\"token number\">5432</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54322</span>\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>network <span class=\"token symbol\">:bridged</span>\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>network <span class=\"token symbol\">:hostonly</span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">\"192.168.100.20\"</span></span>\n\n    db_config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>provision <span class=\"token symbol\">:ansible</span> <span class=\"token keyword\">do</span> <span class=\"token operator\">|</span>ansible<span class=\"token operator\">|</span>\n      ansible<span class=\"token punctuation\">.</span>playbook <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"devops/dbserver.yml\"</span></span>\n      ansible<span class=\"token punctuation\">.</span>hosts <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"dbservers\"</span></span>\n    <span class=\"token keyword\">end</span>\n  <span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>Pretty straight forward. Each server is defined as separate blocks. Within each block the servers are configured with port fowarding and networking information. In this case the servers are configured with both <code class=\"language-text\">:bridged</code> and <code class=\"language-text\">:hostonly</code> networking options. Check out the <a href=\"http://vagrantup.com/v1/docs/index.html\">Vagrant documentation</a> for more information regarding networking options. The important part here is to notice the IP address given to the database server: <code class=\"language-text\">192.168.100.20</code>. This is the address that the application must specify for its database connection.</p>\n<p>Take notice of where Ansible comes in to play. In each server block Vagrant is configured to use Ansible during the provisioning process. A playbook and host group is also specified. Make note that the playbooks' hosts values matches up with the hosts value specified in the server block.</p>\n<h2>Provisioning</h2>\n<p>Given the <code class=\"language-text\">Vagrantfile</code> and the associated playbooks for each server, provisioning each virtual machine is as easy as running the following command from the root folder of the source code:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">vagrant up web <span class=\"token operator\">&amp;&amp;</span> vagrant up db</code></pre></div>\n<p>You'll see a lot of activity in the terminal and will be asked what network adapter to attach each server to enable bridged networking. Select whatever you're machine is using at the moment.</p>\n<h2>Application Development</h2>\n<p>Once the servers are running you're free to develop your application! Notice how the application's <a href=\"https://github.com/mattupstate/vagrant-ansible-tutorial/blob/master/app.py#L6\">database URL</a> is configured with the IP address specified in the Vagrant configuration.</p>\n<p>You also, hypothetically, have the same stack as the staging and production environments. You could even deploy the application as you might do in the staging and production environments as well. The example application can be deployed to the webserver using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">devops/deploy.sh</code></pre></div>\n<p>This will run the deployment playbook against the webserver. Once the playbook has completed its tasks you should be able to go to <a href=\"http://127.0.0.1:8080/\">http://127.0.0.1:8080</a> in your browser and see a list of two users.</p>\n<p>If you ask me, that is how easy it should be to setup a development environment!</p>","frontmatter":{"date":"August 20, 2012","slug":"/blog/multi-server-flask-application-development-enviornment-with-vagrant-and-ansible","title":"Multi Server Flask Application Development Environment with Vagrant and Ansible","description":null}},"metaImageFile":{"relativePath":"images/headshot-summary.png","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#583828","images":{"fallback":{"src":"/static/9798db320c5cad183af92ab85933ac64/38397/headshot-summary.png","srcSet":"/static/9798db320c5cad183af92ab85933ac64/cef30/headshot-summary.png 531w,\n/static/9798db320c5cad183af92ab85933ac64/d6f8b/headshot-summary.png 1061w,\n/static/9798db320c5cad183af92ab85933ac64/38397/headshot-summary.png 2122w","sizes":"(min-width: 2122px) 2122px, 100vw"},"sources":[{"srcSet":"/static/9798db320c5cad183af92ab85933ac64/45ee3/headshot-summary.webp 531w,\n/static/9798db320c5cad183af92ab85933ac64/af37a/headshot-summary.webp 1061w,\n/static/9798db320c5cad183af92ab85933ac64/c2899/headshot-summary.webp 2122w","type":"image/webp","sizes":"(min-width: 2122px) 2122px, 100vw"}]},"width":2122,"height":1070}}}},"pageContext":{"id":"868fa1b5-8c16-5255-8561-487af07ad3fc","frontmatter__slug":"/blog/multi-server-flask-application-development-enviornment-with-vagrant-and-ansible","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["2052298874"]}