{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-js","path":"/blog/running-an-elasticsearch-cluster-on-coreos/","result":{"data":{"markdownRemark":{"html":"<p>Recently I've been experimenting with <a href=\"http://www.docker.com/\">Docker</a> as a build and deployment tool. During my research I stumbled onto a seemingly interesting project called <a href=\"https://coreos.com/\">CoreOS</a>. CoreOS is a new Linux distro tailored for scheduling and deploying services across a cluster of servers. It comes packed with Docker, <a href=\"http://coreos.com/using-coreos/etcd/\">etcd</a> (a distributed key value store), and <a href=\"http://coreos.com/using-coreos/clustering/\">fleet</a> (a distributed init system backed by <a href=\"http://coreos.com/using-coreos/systemd/\">systemd</a>). All really cool stuff. So I decided to check it out and see how I might deploy an <a href=\"http://www.elasticsearch.org/\">ElasticSearch</a> cluster.</p>\n<h2>Environment</h2>\n<p>For the test environment I've used <a href=\"http://www.vagrantup.com/\">Vagrant</a> given that the CoreOS team provides up-to-date CoreOS builds as Vagrant boxes. If you'd like to follow along be sure to install Vagrant first. These are the steps I took to set my environment up:</p>\n<h5>1. Get the files:</h5>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/coreos/coreos-vagrant.git\n<span class=\"token builtin class-name\">cd</span> coreos-vagrant\n</code></pre></div>\n<h5>2. Make copies of the <code class=\"language-text\">config.rb.example</code> and <code class=\"language-text\">user-data.example</code> files:</h5>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">cp</span> config.rb.example config.rb\n<span class=\"token function\">cp</span> user-data.example user-data</code></pre></div>\n<h5>3. Change the number of instances in <code class=\"language-text\">config.rb</code> to 3:</h5>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># config.rb</span>\n<span class=\"token operator\">...</span>\n<span class=\"token variable\">$num_instances</span><span class=\"token operator\">=</span><span class=\"token number\">3</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<h5>4. Set the etcd discovery URL in <code class=\"language-text\">user-data</code>:</h5>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">curl</span> http://discovery.etcd.io/new\n<span class=\"token operator\">&lt;</span>discovery-url<span class=\"token operator\">></span>\n\n<span class=\"token comment\"># user-data</span>\ncoreos:\n  etcd:\n    discovery: <span class=\"token operator\">&lt;</span>discovery-url<span class=\"token operator\">></span>\n<span class=\"token punctuation\">..</span>.</code></pre></div>\n<h5>5. Uncomment the <code class=\"language-text\">synced_folder</code> option in <code class=\"language-text\">Vagrantfile</code>:</h5>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\"><span class=\"token comment\"># Vagrantfile</span>\n<span class=\"token operator\">...</span>\n      config<span class=\"token punctuation\">.</span>vm<span class=\"token punctuation\">.</span>synced_folder <span class=\"token string-literal\"><span class=\"token string\">\".\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string-literal\"><span class=\"token string\">\"/home/core/share\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">id</span><span class=\"token operator\">:</span> <span class=\"token string-literal\"><span class=\"token string\">\"core\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:nfs</span> <span class=\"token operator\">=></span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token symbol\">:mount_options</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">'nolock,vers=3,udp'</span></span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<h5>6. Start the machines:</h5>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">vagrant up</code></pre></div>\n<h5>7. Verify the cluster:</h5>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">vagrant <span class=\"token function\">ssh</span> core-01 -- <span class=\"token parameter variable\">-A</span>\nLast login: Wed Jun <span class=\"token number\">25</span> <span class=\"token number\">23</span>:57:32 <span class=\"token number\">2014</span> from <span class=\"token number\">10.0</span>.2.2\nCoreOS <span class=\"token punctuation\">(</span>alpha<span class=\"token punctuation\">)</span>\ncore@core-01 ~ $ fleetctl list-machines\nMACHINE     IP      METADATA\n4874973d<span class=\"token punctuation\">..</span>. <span class=\"token number\">172.17</span>.8.102    -\n7f0af17f<span class=\"token punctuation\">..</span>. <span class=\"token number\">172.17</span>.8.103    -\n847600c0<span class=\"token punctuation\">..</span>. <span class=\"token number\">172.17</span>.8.101    -\n</code></pre></div>\n<h2>Service Units</h2>\n<p>To run the cluster I've decided to use two service units, one for ElasticSearch itself and another to act as a \"discovery\" service. One instance of each service will be deployed to each machine in the cluster for a total of six service instances.</p>\n<h3>Discovery Service</h3>\n<p>The Discovery Sevice will act as a sort of health check for an ElasticSearch service. This is enabled with a basic bash script that sets a key for the machine in etcd if the service is available or removes the key if the service is not available. The idea here is that when additional ElasticSearch instances are deployed they can join the cluster by asking etcd for the currently deployed ElasticSearch services. The discovery service looks this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token comment\"># elasticsearch-discovery@.service</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Unit</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">Description</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">ElasticSearch discovery service</span>\n<span class=\"token key attr-name\">BindsTo</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">elasticsearch@%i.service</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Service</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">EnvironmentFile</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/etc/environment</span>\n\n<span class=\"token key attr-name\">ExecStart</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/bin/bash -c '\\</span>\n  while true; do \\\n    curl -f ${COREOS_PRIVATE_IPV4}:9200; \\\n    <span class=\"token key attr-name\">if [ \"$?\"</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"0\" ]; then \\</span>\n      etcdctl set /services/elasticsearch/${COREOS_PRIVATE_IPV4} \\'{\"http_port\": 9200, \"transport_port\": 9300}\\' --ttl 60; \\\n    else \\\n      etcdctl rm /services/elasticsearch/${COREOS_PRIVATE_IPV4}; \\\n    fi; \\\n    sleep 45; \\\n  done'\n\n<span class=\"token key attr-name\">ExecStop</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/etcdctl rm /services/elasticsearch/${COREOS_PRIVATE_IPV4}</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">X-Fleet</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">X-ConditionMachineOf</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">elasticsearch@%i.service</span></code></pre></div>\n<p>The bash script that does the work uses <code class=\"language-text\">curl</code> to make a request to the local ElasticSearch service running on port 9200. Passing the <code class=\"language-text\">-f</code> flag to <code class=\"language-text\">curl</code> allows one to get a more meaningful exit code and in this case it is used as the conditional to set or remove the key in etcd. Take note of the <code class=\"language-text\">BindsTo=</code> directive. This tells <code class=\"language-text\">systemd</code> that this service should be started only when the corresponding ElasticSearch service is started. Additionally, I've specified that this service should be deployed to the same machine as the corresponding ElasticSearch service with the <code class=\"language-text\">X-ConditionMachineOf=</code> directive.</p>\n<h3>ElasticSearch Service</h3>\n<p>The ElasticSearch Service runs, not surprisingly, ElasticSearch. The service looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token comment\"># elasticsearch@.service</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Unit</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">Description</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">ElasticSearch service</span>\n<span class=\"token key attr-name\">After</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">docker.service</span>\n<span class=\"token key attr-name\">Requires</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">docker.service</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">Service</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">TimeoutSec</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">180</span>\n<span class=\"token key attr-name\">EnvironmentFile</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/etc/environment</span>\n\n<span class=\"token key attr-name\">ExecStartPre</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/mkdir -p /data/elasticsearch</span>\n<span class=\"token key attr-name\">ExecStartPre</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/docker pull dockerfile/elasticsearch</span>\n\n<span class=\"token key attr-name\">ExecStart</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/bin/bash -c '\\</span>\n  curl -f ${COREOS_PRIVATE_IPV4}:4001/v2/keys/services/elasticsearch; \\\n  <span class=\"token key attr-name\">if [ \"$?\"</span> <span class=\"token punctuation\">=</span> <span class=\"token value attr-value\">\"0\" ]; then \\</span>\n      <span class=\"token key attr-name\">UNICAST_HOSTS</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">$(etcdctl ls --recursive /services/elasticsearch \\</span>\n                      | sed \"s/\\/services\\/elasticsearch\\///g\" \\\n                      | sed \"s/$/:9300/\" \\\n                      | paste -s -d\",\"); \\\n  else \\\n      <span class=\"token key attr-name\">UNICAST_HOSTS</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">\"\"; \\</span>\n  fi; \\\n  /usr/bin/docker run \\\n    --name %p-%i \\\n    --publish 9200:9200 \\\n    --publish 9300:9300 \\\n    --volume /data/elasticsearch:/data \\\n    dockerfile/elasticsearch \\\n    /elasticsearch/bin/elasticsearch \\\n    <span class=\"token key attr-name\">--node.name</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">%p-%i \\</span>\n    <span class=\"token key attr-name\">--cluster.name</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">logstash \\</span>\n    <span class=\"token key attr-name\">--network.publish_host</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">${COREOS_PRIVATE_IPV4} \\</span>\n    <span class=\"token key attr-name\">--discovery.zen.ping.multicast.enabled</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false \\</span>\n    <span class=\"token key attr-name\">--discovery.zen.ping.unicast.hosts</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">$UNICAST_HOSTS'</span>\n\n<span class=\"token key attr-name\">ExecStop</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/docker stop %p-%i</span>\n<span class=\"token key attr-name\">ExecStop</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">/usr/bin/docker rm %p-%i</span>\n\n<span class=\"token section\"><span class=\"token punctuation\">[</span><span class=\"token section-name selector\">X-Fleet</span><span class=\"token punctuation\">]</span></span>\n<span class=\"token key attr-name\">X-Conflicts</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">%p@*.service</span></code></pre></div>\n<p>First note that a directory is created in a <code class=\"language-text\">ExecStartPre=</code> directive on the host machine to store the ElasticSearch data. This is then mounted to the Docker container and allows the ElasticSearch data to survive service restarts. Next of note is the bash script that starts ElasticSearch. In this script a variable is conditionally set to a comma separated list of IP and port pairs for the currently running ElasticSearch services. This variable is then used to configure the service's unicast hosts option so that the new service will join the cluster. Unicast is used here because multicast is not supported in a Docker environment. Lastly, the <code class=\"language-text\">X-Conflicts=</code> directive ensures that there will be but one ElasticSearch service per machine in the cluster.</p>\n<h2>Deploying</h2>\n<p>Deploying the services is done with the <code class=\"language-text\">fleetctl</code> command line tool. It is a good idea to first deploy the Discovery Service so that it will automatically be started when the ElasticSearch Service is deployed. First, make sure you have ssh'd into one of the machines and using the synced folder as your working directory:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">vagrant <span class=\"token function\">ssh</span> core-01 -- <span class=\"token parameter variable\">-A</span>\nLast login: Wed Jun <span class=\"token number\">25</span> <span class=\"token number\">23</span>:57:32 <span class=\"token number\">2014</span> from <span class=\"token number\">10.0</span>.2.2\nCoreOS <span class=\"token punctuation\">(</span>alpha<span class=\"token punctuation\">)</span>\ncore@core-01 ~ $ <span class=\"token builtin class-name\">cd</span> share</code></pre></div>\n<p>The next step is to \"submit\" the Discovery Service to <code class=\"language-text\">fleet</code> so that it is ready and waiting for the upcoming ElasticSearch services to be deployed:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share $ fleetctl submit elasticsearch-discovery@<span class=\"token punctuation\">{</span><span class=\"token number\">1,2</span>,3<span class=\"token punctuation\">}</span>.service</code></pre></div>\n<p>Now its time to start and wait for at least one ElasticSearch service to be deployed:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share $ fleetctl start elasticsearch@1.service\nJob elasticsearch@1.service launched on 7f0af17f<span class=\"token punctuation\">..</span>./172.17.8.103</code></pre></div>\n<p>This first time this is deployed it can take a little while since Docker will have to pull the <code class=\"language-text\">dockerfile/elasticsearch</code> image from the public registry the first time. Normally <code class=\"language-text\">systemd</code> would timeout, but I've added a <code class=\"language-text\">TimeoutSec=</code> directive to the service unit to allow for this condition. If you want to watch the progress of this first service as it starts up you can tail the logs by running the <code class=\"language-text\">fleetctl journal</code> command. You should see something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share $ fleetctl journal <span class=\"token parameter variable\">-f</span> elasticsearch@1.service\n-- Logs begin at Wed <span class=\"token number\">2014</span>-06-25 <span class=\"token number\">18</span>:03:29 UTC. --\nJun <span class=\"token number\">26</span> 03:08:57 core-03 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Starting ElasticSearch service<span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:08:57 core-03 docker<span class=\"token punctuation\">[</span><span class=\"token number\">31109</span><span class=\"token punctuation\">]</span>: Pulling repository dockerfile/elasticsearch\nJun <span class=\"token number\">26</span> 03:09:01 core-03 docker<span class=\"token punctuation\">[</span><span class=\"token number\">31136</span><span class=\"token punctuation\">]</span>: Pulling repository dockerfile/elasticsearch\nJun <span class=\"token number\">26</span> 03:09:04 core-03 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Started ElasticSearch service.\nJun <span class=\"token number\">26</span> 03:09:04 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\nJun <span class=\"token number\">26</span> 03:09:04 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: Dload  Upload   Total   Spent    Left  Speed\nJun <span class=\"token number\">26</span> 03:09:04 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span>155B blob data<span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:09:06 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">{</span><span class=\"token string\">\"action\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"get\"</span>,<span class=\"token string\">\"node\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"key\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/services/elasticsearch\"</span>,<span class=\"token string\">\"dir\"</span>:true,<span class=\"token string\">\"modifiedIndex\"</span>:493,<span class=\"token string\">\"createdIndex\"</span>:493<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:06,159<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> version<span class=\"token punctuation\">[</span><span class=\"token number\">1.2</span>.1<span class=\"token punctuation\">]</span>, pid<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>, build<span class=\"token punctuation\">[</span>6c95b75/2014-06-03T15:02:52Z<span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:09:06 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:06,160<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> initializing <span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:09:06 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:06,167<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>plugins                  <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> loaded <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>, sites <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:09:09 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:09,432<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> initialized\nJun <span class=\"token number\">26</span> 03:09:09 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:09,433<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> starting <span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:09:09 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:09,521<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>transport                <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> bound_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/0:0:0:0:0:0:0:0:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>, publish_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\nJun <span class=\"token number\">26</span> 03:09:12 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:12,551<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cluster.service          <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> new_master <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>oDMLhfaqQPupW-Kx7053Eg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>528834ab92f2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>, reason: zen-disco-join <span class=\"token punctuation\">(</span>elected_as_master<span class=\"token punctuation\">)</span>\nJun <span class=\"token number\">26</span> 03:09:12 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:12,595<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>discovery                <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> logstash/oDMLhfaqQPupW-Kx7053Eg\nJun <span class=\"token number\">26</span> 03:09:12 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:12,627<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>http                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> bound_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/0:0:0:0:0:0:0:0:9200<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>, publish_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9200<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\nJun <span class=\"token number\">26</span> 03:09:12 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:12,648<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>gateway                  <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> recovered <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> indices into cluster_state\nJun <span class=\"token number\">26</span> 03:09:12 core-03 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31144</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:09:12,649<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span> started</code></pre></div>\n<p>Once the first ElasticSearch service is up and running you can now add additional \"nodes\" to the cluster by running additional services:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share fleetctl start elasticsearch@<span class=\"token punctuation\">{</span><span class=\"token number\">2,3</span><span class=\"token punctuation\">}</span>.service\nJob elasticsearch@2.service launched on 847600c0<span class=\"token punctuation\">..</span>./172.17.8.101\nJob elasticsearch@3.service launched on 4874973d<span class=\"token punctuation\">..</span>./172.17.8.102</code></pre></div>\n<p>And again, tail one of the services to watch the startup progress:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share $ fleetctl journal <span class=\"token parameter variable\">-f</span> elasticsearch@2.service\n-- Logs begin at Wed <span class=\"token number\">2014</span>-06-25 <span class=\"token number\">18</span>:02:30 UTC. --\nJun <span class=\"token number\">26</span> 03:15:27 core-01 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Starting ElasticSearch service<span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:15:27 core-01 docker<span class=\"token punctuation\">[</span><span class=\"token number\">31265</span><span class=\"token punctuation\">]</span>: Pulling repository dockerfile/elasticsearch\nJun <span class=\"token number\">26</span> 03:15:29 core-01 docker<span class=\"token punctuation\">[</span><span class=\"token number\">31286</span><span class=\"token punctuation\">]</span>: Pulling repository dockerfile/elasticsearch\nJun <span class=\"token number\">26</span> 03:15:32 core-01 systemd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>: Started ElasticSearch service.\nJun <span class=\"token number\">26</span> 03:15:32 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\nJun <span class=\"token number\">26</span> 03:15:32 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: Dload  Upload   Total   Spent    Left  Speed\nJun <span class=\"token number\">26</span> 03:15:32 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span>155B blob data<span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:15:33 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">{</span><span class=\"token string\">\"action\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"get\"</span>,<span class=\"token string\">\"node\"</span>:<span class=\"token punctuation\">{</span><span class=\"token string\">\"key\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/services/elasticsearch\"</span>,<span class=\"token string\">\"dir\"</span>:true,<span class=\"token string\">\"nodes\"</span>:<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"key\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"/services/elasticsearch/172.17.8.103\"</span>,<span class=\"token string\">\"value\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"{<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>http_port<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: 9200, <span class=\"token entity\" title=\"\\&quot;\">\\\"</span>transport_port<span class=\"token entity\" title=\"\\&quot;\">\\\"</span>: 9300}\"</span>,<span class=\"token string\">\"expiration\"</span><span class=\"token builtin class-name\">:</span><span class=\"token string\">\"2014-06-26T03:16:10.516041728Z\"</span>,<span class=\"token string\">\"ttl\"</span>:39,<span class=\"token string\">\"modifiedIndex\"</span>:35199,<span class=\"token string\">\"createdIndex\"</span>:35199<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>,<span class=\"token string\">\"modifiedIndex\"</span>:493,<span class=\"token string\">\"createdIndex\"</span>:493<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:33,505<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> version<span class=\"token punctuation\">[</span><span class=\"token number\">1.2</span>.1<span class=\"token punctuation\">]</span>, pid<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>, build<span class=\"token punctuation\">[</span>6c95b75/2014-06-03T15:02:52Z<span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:15:33 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:33,506<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> initializing <span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:15:33 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:33,512<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>plugins                  <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> loaded <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>, sites <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nJun <span class=\"token number\">26</span> 03:15:36 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:36,907<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> initialized\nJun <span class=\"token number\">26</span> 03:15:36 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:36,908<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> starting <span class=\"token punctuation\">..</span>.\nJun <span class=\"token number\">26</span> 03:15:37 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:37,001<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>transport                <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> bound_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/0:0:0:0:0:0:0:0:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>, publish_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/172.17.8.101:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\nJun <span class=\"token number\">26</span> 03:15:40 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:40,133<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cluster.service          <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> detected_master <span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>oDMLhfaqQPupW-Kx7053Eg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>528834ab92f2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>, added <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>oDMLhfaqQPupW-Kx7053Eg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>528834ab92f2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>,<span class=\"token punctuation\">}</span>, reason: zen-disco-receive<span class=\"token punctuation\">(</span>from master <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>oDMLhfaqQPupW-Kx7053Eg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>528834ab92f2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nJun <span class=\"token number\">26</span> 03:15:40 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:40,174<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>discovery                <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> logstash/fnMFB1wMTZmNiQ96MS3cQw\nJun <span class=\"token number\">26</span> 03:15:40 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:40,182<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>http                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> bound_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/0:0:0:0:0:0:0:0:9200<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>, publish_address <span class=\"token punctuation\">{</span>inet<span class=\"token punctuation\">[</span>/172.17.8.101:9200<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\nJun <span class=\"token number\">26</span> 03:15:40 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:40,186<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>node                     <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> started\nJun <span class=\"token number\">26</span> 03:15:42 core-01 bash<span class=\"token punctuation\">[</span><span class=\"token number\">31299</span><span class=\"token punctuation\">]</span>: <span class=\"token punctuation\">[</span><span class=\"token number\">2014</span>-06-26 03:15:42,692<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>INFO <span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>cluster.service          <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>elasticsearch-2<span class=\"token punctuation\">]</span> added <span class=\"token punctuation\">{</span><span class=\"token punctuation\">[</span>elasticsearch-3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>F5mpLliyS5m6Hl5-GI59Sg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>e72be2b7be66<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.102:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>,<span class=\"token punctuation\">}</span>, reason: zen-disco-receive<span class=\"token punctuation\">(</span>from master <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>elasticsearch-1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>oDMLhfaqQPupW-Kx7053Eg<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>528834ab92f2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>inet<span class=\"token punctuation\">[</span>/172.17.8.103:9300<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Notice in the log output that the new service has detected the first service as the master node! Finally, its just a good idea to verify the state of the ElasticSearch cluster with a plain old <code class=\"language-text\">curl</code> call:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">core@core-01 ~/share $ <span class=\"token function\">curl</span> localhost:9200/_cluster/state?pretty<span class=\"token operator\">=</span>true\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"cluster_name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"logstash\"</span>,\n  <span class=\"token string\">\"version\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token number\">5</span>,\n  <span class=\"token string\">\"master_node\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"oDMLhfaqQPupW-Kx7053Eg\"</span>,\n  <span class=\"token string\">\"blocks\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"nodes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"oDMLhfaqQPupW-Kx7053Eg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"elasticsearch-1\"</span>,\n      <span class=\"token string\">\"transport_address\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"inet[/172.17.8.103:9300]\"</span>,\n      <span class=\"token string\">\"attributes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>,\n    <span class=\"token string\">\"fnMFB1wMTZmNiQ96MS3cQw\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"elasticsearch-2\"</span>,\n      <span class=\"token string\">\"transport_address\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"inet[/172.17.8.101:9300]\"</span>,\n      <span class=\"token string\">\"attributes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>,\n    <span class=\"token string\">\"F5mpLliyS5m6Hl5-GI59Sg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"elasticsearch-3\"</span>,\n      <span class=\"token string\">\"transport_address\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"inet[/172.17.8.102:9300]\"</span>,\n      <span class=\"token string\">\"attributes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"metadata\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"templates\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>,\n    <span class=\"token string\">\"indices\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"routing_table\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"indices\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"routing_nodes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"unassigned\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span>,\n    <span class=\"token string\">\"nodes\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"oDMLhfaqQPupW-Kx7053Eg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span>,\n      <span class=\"token string\">\"F5mpLliyS5m6Hl5-GI59Sg\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span>,\n      <span class=\"token string\">\"fnMFB1wMTZmNiQ96MS3cQw\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token string\">\"allocations\"</span> <span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hooray! All three nodes are in the cluster.</p>\n<h2>Conclusion</h2>\n<p>So I think its safe to say that you could easily run an ElasticSearch cluster on CoreOS. However, I wouldn't say this is ready for a production environment quite yet given that CoreOS is still under very heavy development. But this is certainly very promising and feels like a great way to deploy apps and services.</p>\n<p>So what now? Well, ElasticSearch can be used for all sorts of things. One of the most common use cases that I'm familiar with is for log aggregation. This <em>could</em> be enabled by running a <a href=\"http://logstash.net/\">Logstash</a> agent and a <a href=\"https://github.com/progrium/logspout\">logspout</a> container on each machine. In fact, I've prototyped this and will write more about this in a later post!</p>","frontmatter":{"date":"June 26, 2014","slug":"/blog/running-an-elasticsearch-cluster-on-coreos","title":"Running an ElasticSearch Cluster on CoreOS","description":null}},"metaImageFile":{"relativePath":"images/headshot-summary.png","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#583828","images":{"fallback":{"src":"/static/9798db320c5cad183af92ab85933ac64/38397/headshot-summary.png","srcSet":"/static/9798db320c5cad183af92ab85933ac64/cef30/headshot-summary.png 531w,\n/static/9798db320c5cad183af92ab85933ac64/d6f8b/headshot-summary.png 1061w,\n/static/9798db320c5cad183af92ab85933ac64/38397/headshot-summary.png 2122w","sizes":"(min-width: 2122px) 2122px, 100vw"},"sources":[{"srcSet":"/static/9798db320c5cad183af92ab85933ac64/45ee3/headshot-summary.webp 531w,\n/static/9798db320c5cad183af92ab85933ac64/af37a/headshot-summary.webp 1061w,\n/static/9798db320c5cad183af92ab85933ac64/c2899/headshot-summary.webp 2122w","type":"image/webp","sizes":"(min-width: 2122px) 2122px, 100vw"}]},"width":2122,"height":1070}}}},"pageContext":{"id":"e1dafbad-20d6-5cc6-8d4e-25e6c0687fdf","frontmatter__slug":"/blog/running-an-elasticsearch-cluster-on-coreos","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["2052298874"]}